// ---------- Practice pile hover "repel" ----------
(() => {
  const pile = document.getElementById("practicePile");
  if (!pile) return;

  const photos = Array.from(pile.querySelectorAll(".practice-photo"));

  function parsePx(v) {
    const n = parseFloat(String(v).replace("px",""));
    return Number.isFinite(n) ? n : 0;
  }

  function getXY(el) {
    const styles = getComputedStyle(el);
    // pull the layout vars you set inline
    const x = parsePx(styles.getPropertyValue("--x"));
    const y = parsePx(styles.getPropertyValue("--y"));
    return { x, y };
  }

  function setPush(el, px, py) {
    el.style.setProperty("--pushx", `${px}px`);
    el.style.setProperty("--pushy", `${py}px`);
  }

  function clearPushAll() {
    photos.forEach(p => {
      p.classList.remove("is-active");
      p.style.removeProperty("--pushx");
      p.style.removeProperty("--pushy");
    });
    pile.classList.remove("is-hovering");
  }

  photos.forEach(active => {
    active.addEventListener("mouseenter", () => {
      pile.classList.add("is-hovering");
      photos.forEach(p => p.classList.remove("is-active"));
      active.classList.add("is-active");

      const a = getXY(active);

      photos.forEach(p => {
        if (p === active) return;

        const b = getXY(p);
        let dx = b.x - a.x;
        let dy = b.y - a.y;

        // normalize direction (avoid divide by 0)
        const mag = Math.hypot(dx, dy) || 1;
        dx /= mag;
        dy /= mag;

        // how far others move away (tweak these numbers)
        const strength = 10;      // pixels
        setPush(p, dx * strength, dy * strength);
      });
    });

    active.addEventListener("mouseleave", () => {
      // gentle reset (small delay feels nicer)
      setTimeout(() => {
        if (!pile.matches(":hover")) clearPushAll();
      }, 30);
    });
  });

  pile.addEventListener("mouseleave", clearPushAll);
})();
